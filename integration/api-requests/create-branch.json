{
  "_comment": "POST https://api.boomi.com/partner/api/rest/v1/{primaryAccountId}/Branch",
  "_notes": [
    "Creates a new branch in the primary (production) account",
    "Branch name follows pattern: promo-{promotionId}",
    "After creation, poll GET /Branch/{branchId} until ready=true (typically 5-30s)",
    "Branch limit: 15 operational threshold (20 hard platform limit) — check count before creation",
    "All terminal paths (approve, reject, deny) must DELETE the branch",
    "Components are promoted to the branch via tilde syntax: POST /Component/{id}~{branchId}"
  ],
  "_available_fields_not_used": [
    "parentId (string) — branch from a specific component version (by componentId). Mutually exclusive with packageId.",
    "deploymentId (string) — branch from a specific deployment snapshot.",
    "These fields are unused in this project."
  ],
  "_packageId_usage": [
    "packageId (string) — branch from a specific PackagedComponent version instead of HEAD. Mutually exclusive with parentId.",
    "Used in Mode 2 (production-from-test): create a branch from the test PackagedComponent (prodPackageId from the TEST PromotionLog record) to prepare for merge to main.",
    "Process D sets packageId = testPromotionLog.prodPackageId when mode=2 to ensure the branch matches exactly what was validated in test.",
    "For Mode 1 (test) and Mode 3 (hotfix), omit packageId — branch from HEAD (current main state)."
  ],
  "_lifecycle": [
    "Mode 1 (test): CREATE from HEAD → PROMOTE components → PACKAGE from branch (branchName set) → deploy to test → branch persists for future production",
    "Mode 2 (production-from-test): CREATE from test packageId → MergeRequest OVERRIDE → execute MERGE → PACKAGE from main → deploy to production → DELETE branch",
    "Mode 3 (hotfix): CREATE from HEAD → PROMOTE components → PACKAGE from branch → release to production → release to test → DELETE branch",
    "1. CREATE: POST /Branch → returns branchId",
    "2. POLL: GET /Branch/{branchId} until ready=true",
    "3. PROMOTE: Process C writes to branch via Component/{id}~{branchId}",
    "4. REVIEW: Process G reads branch vs main for diff",
    "5a. APPROVE: MergeRequest OVERRIDE → execute MERGE → Package from main → DELETE branch",
    "5b. REJECT/DENY: DELETE /Branch/{branchId} — main untouched"
  ],
  "_http_operation": {
    "method": "POST",
    "url": "/partner/api/rest/v1/{primaryAccountId}/Branch",
    "urlParameters": {
      "{primaryAccountId}": "DPP: primaryAccountId"
    },
    "headers": {
      "Accept": "application/json",
      "Content-Type": "application/json"
    }
  },
  "_pre_check": {
    "description": "Before creating, query existing branches to enforce limit",
    "method": "POST",
    "url": "/partner/api/rest/v1/{primaryAccountId}/Branch/query",
    "body": "<QueryFilter xmlns='http://api.platform.boomi.com/'/>",
    "threshold": 15,
    "errorCode": "BRANCH_LIMIT_REACHED",
    "errorMessage": "Too many active promotions. Please wait for pending reviews to complete."
  },
  "name": "promo-{promotionId}",
  "description": "Promotion branch for {promotionId}",
  "_packageId_conditional": "Include packageId only for Mode 2 (production-from-test). Set to testPromotionLog.prodPackageId.",
  "packageId": "{testProdPackageId}"
}
